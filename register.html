<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>New Subscriber Registration - SMARTLINKX</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-row">
      <div class="brand">
        <div class="logo">S</div>
        <div>
          <div class="brand-name">SMARTLINKX</div>
          <div class="brand-tag">New Subscriber Registration</div>
        </div>
      </div>

      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="register.html" class="active">New Subscriber</a>
        <a href="masterfile.html">Masterfile</a>
        <a href="billing.html">Billing</a>
        <a href="payments.html">Payments</a>
      </nav>
    </div>
  </header>

  <main class="section">
    <div class="container">
      <h1>New Subscriber Registration</h1>
      <p class="muted">Subscriber ID is generated automatically to avoid duplicates.</p>

      <div class="card">
        <form id="registrationForm" class="form-grid">

          <div class="field">
            <label>Date</label>
            <input type="date" name="date" id="date" required />
          </div>

          <div class="field">
            <label>Subscriber ID</label>
            <input type="text" name="subscriberId" id="subscriberId" readonly />
            <small class="muted">Auto-generated</small>
          </div>

          <div class="field">
            <label>Plan</label>
            <select name="plan" id="planSelect" required></select>
          </div>

          <div class="field">
            <label>Name</label>
            <input type="text" name="name" placeholder="Subscriber full name" required />
          </div>

          <div class="field">
            <label>Contact No.</label>
            <input type="text" name="contactNo" placeholder="09xx..." required />
          </div>

          <div class="field full">
            <label>Address</label>
            <input type="text" name="address" placeholder="Complete address" required />
          </div>

          <div class="field">
            <label>Installation Fee (₱)</label>
            <input type="number" name="installationFee" id="installationFee" required />
          </div>

          <div class="field">
            <label>Monthly Payment (₱)</label>
            <input type="number" name="monthlyPayment" id="monthlyPayment" required />
          </div>

          <div class="field">
            <label>MAC Address</label>
            <input type="text" name="macAddress" placeholder="Optional" />
          </div>

          <div class="field">
            <label>IP Address</label>
            <input type="text" name="ipAddress" placeholder="Optional" />
          </div>

          <div class="field full">
            <button class="btn primary" type="submit" id="submitBtn">
              Submit Registration
            </button>
          </div>

          <div class="field full">
            <div class="alert" id="statusBox" style="display:none;"></div>
          </div>
        </form>
      </div>

      <div class="card info">
        <h3>Default Pricing</h3>
        <ul class="clean">
          <li>Installation Fee: <b>₱2,000</b></li>
          <li>Plans: <b>20Mbps ₱699</b>, <b>100Mbps ₱1299</b></li>
        </ul>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div>© <span id="year"></span> SMARTLINKX</div>
    </div>
  </footer>

  <script src="app.js"></script>
  <script>
    // ===============================
    // Helpers
    // ===============================
    function todayISO(){
      const d = new Date();
      return d.toISOString().slice(0,10);
    }

    function setStatus(el, msg, type){
      el.style.display = "block";
      el.className = "alert " + (type || "");
      el.textContent = msg;
    }

    // ===============================
    // Init defaults
    // ===============================
    const dateInput = document.getElementById("date");
    const idInput = document.getElementById("subscriberId");
    const statusBox = document.getElementById("statusBox");
    dateInput.value = todayISO();

    document.getElementById("year").textContent = new Date().getFullYear();

    // ===============================
    // AUTO-GENERATE SUBSCRIBER ID
    // ===============================
    async function loadNextSubscriberId(){
  try {
    if (!API_URL) return;
    
    const API_URL = "https://script.google.com/macros/s/AKfycbyX-2aiopFR0EIcjLhW9Q2OQ-3BJ-zwSJshRgTcOrC_E1WbA0yxOTt2jzs5o67u6DBOLQ/exec";
    const adminKey = "SMARTLINKX_ISP_04082025"; // SAME as Apps Script

    const res = await fetch(
      `${API_URL}?action=nextid&key=${encodeURIComponent(adminKey)}`
    );

        const json = await res.json();

        if (json.ok && json.nextId) {
          idInput.value = json.nextId;
        } else {
          setStatus(statusBox, "Failed to generate Subscriber ID.", "bad");
        }
      } catch (err) {
        setStatus(statusBox, "Error loading Subscriber ID.", "bad");
      }
    }

    // Load ID on page open
    loadNextSubscriberId();
  </script>
</body>
</html>
